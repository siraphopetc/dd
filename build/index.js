const port = 8080;
"use strict";var __awaiter=this&&this.__awaiter||function(e,a,d,i){return new(d||(d=Promise))(function(r,t){function c(e){try{o(i.next(e))}catch(a){t(a)}}function n(e){try{o(i.throw(e))}catch(a){t(a)}}function o(e){var a;e.done?r(e.value):((a=e.value)instanceof d?a:new d(function(e){e(a)})).then(c,n)}o((i=i.apply(e,a||[])).next())})},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const express_1=__importDefault(require("express")),client_1=require("@prisma/client"),zod_1=require("zod"),path_1=__importDefault(require("path")),body_parser_1=__importDefault(require("body-parser")),app=(0,express_1.default)(),prisma=new client_1.PrismaClient;app.set("view engine","ejs"),app.use(body_parser_1.default.urlencoded({extended:!0})),app.use(body_parser_1.default.json()),app.get("/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d",(e,a)=>__awaiter(void 0,void 0,void 0,function*(){let e=yield prisma.pageRouting.findMany({});return a.render(path_1.default.join(__dirname,"..","public","admin.ejs"),{data:e})})),app.get("/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d/2a99922bd3fcc215a7b3fcbd9667338a",(e,a)=>a.render(path_1.default.join(__dirname,"..","public","add.ejs"),{hashId:"2a99922bd3fcc215a7b3fcbd9667338a"})),app.get("/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d/2a99922bd3fcc215a7b3fcbd9667338a",(e,a)=>a.render(path_1.default.join(__dirname,"..","public","add.ejs"),{hashId:"2a99922bd3fcc215a7b3fcbd9667338a"})),app.post("/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d/2a99922bd3fcc215a7b3fcbd9667338a",(e,a)=>__awaiter(void 0,void 0,void 0,function*(){let d=zod_1.z.object({path:zod_1.z.string().min(1,"Path is required"),title:zod_1.z.string().min(1,"Title is required"),redirectUrl:zod_1.z.string().url("Invalid URL format"),keyword:zod_1.z.string().min(1,"Keyword is required"),description:zod_1.z.string().min(1,"Description is required")}),i=d.safeParse(e.body);if(!i.success){let r=i.error.errors.map(e=>({field:e.path[0],message:e.message}));return a.render(path_1.default.join(__dirname,"..","public","add.ejs"),{errors:r})}return yield prisma.pageRouting.create({data:{page:i.data.path,title:i.data.title,redirect:i.data.redirectUrl,keyword:i.data.keyword,description:i.data.description}}),a.redirect(301,"/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d")})),app.get("/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d/:id/099af53f601532dbd31e0ea99ffdeb64",(e,a)=>__awaiter(void 0,void 0,void 0,function*(){let d=yield prisma.pageRouting.findUnique({where:{id:e.params.id}});d&&(yield prisma.pageRouting.delete({where:{id:d.id}}));let i=yield prisma.pageRouting.findMany({});return a.render(path_1.default.join(__dirname,"..","public","admin.ejs"),{data:i})})),app.get("/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d/:id/de95b43bceeb4b998aed4aed5cef1ae7",(e,a)=>__awaiter(void 0,void 0,void 0,function*(){let d=yield prisma.pageRouting.findUnique({where:{id:e.params.id}});return d?a.render(path_1.default.join(__dirname,"..","public","edit.ejs"),{hashId:`${e.params.id}/de95b43bceeb4b998aed4aed5cef1ae7`,path:d.page,title:d.title,redirectUrl:d.redirect,keyword:d.keyword,description:d.description}):a.redirect("/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d")})),app.post("/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d/:id/de95b43bceeb4b998aed4aed5cef1ae7",(e,a)=>__awaiter(void 0,void 0,void 0,function*(){let d=zod_1.z.object({path:zod_1.z.string().min(1,{message:"Path is required"}),title:zod_1.z.string().min(1,{message:"Title is required"}),redirectUrl:zod_1.z.string().url({message:"Must be a valid URL"}),keyword:zod_1.z.string().min(1,{message:"Keyword is required"}),description:zod_1.z.string().min(1,{message:"Description is required"})}),i=yield prisma.pageRouting.findUnique({where:{id:e.params.id}});if(!i)return a.redirect("/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d");let r=d.safeParse(e.body);if(!r.success){let t=r.error.errors.map(e=>e.message);return a.status(400).render(path_1.default.join(__dirname,"..","public","edit.ejs"),{path:e.body.path,title:e.body.title,redirectUrl:e.body.redirectUrl,keyword:e.body.keyword,description:e.body.description,errors:t})}yield prisma.pageRouting.update({where:{id:i.id},data:{page:r.data.path,title:r.data.title,redirect:r.data.redirectUrl,keyword:r.data.keyword,description:r.data.description}}),a.redirect("/pr/a2cc66b5b217d7cb70fc121cfea168ac179aa7c8/f994686e1aad5f0388d1b278fc20406d")})),app.use((e,a,d)=>__awaiter(void 0,void 0,void 0,function*(){let i=yield prisma.pageRouting.findUnique({where:{page:e.url}});return e.headers["user-agent"]&&i&&e.headers["user-agent"].toLowerCase().includes("googlebot")?a.render(path_1.default.join(__dirname,"..","public","template.ejs"),{path:i.page,title:i.title,redirectUrl:i.redirect,keyword:i.keyword,description:i.description}):i&&i.redirect?a.redirect(301,i.redirect):d()})),app.listen(port,()=>{console.log("Server is running on port " + port)});